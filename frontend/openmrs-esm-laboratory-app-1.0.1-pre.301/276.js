"use strict";(globalThis.webpackChunk_openmrs_esm_laboratory_app=globalThis.webpackChunk_openmrs_esm_laboratory_app||[]).push([[276],{1728:(e,t,r)=>{r.d(t,{c:()=>s});var n=r(6004),a=r.n(n),o=r(1056),l=r.n(o)()(a());l.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-laboratory__loader__loading___zfL1W{display:flex;background-color:#f4f4f4;justify-content:center;min-height:3rem}","",{version:3,sources:["webpack://./node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/components/loader/loader.scss","webpack://./node_modules/@carbon/layout/scss/generated/_spacing.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCpDF,0CACE,YAAA,CACA,wBDcwB,CCbxB,sBAAA,CACA,eC4CW",sourceRoot:""}]),l.locals={loading:"-esm-laboratory__loader__loading___zfL1W"};const s=l},355:(e,t,r)=>{r.d(t,{c:()=>s});var n=r(6004),a=r.n(n),o=r(1056),l=r.n(o)()(a());l.push([e.id,".-esm-laboratory__actions__menuItem___eDc9z{max-width:none}","",{version:3,sources:["webpack://./src/lab-tabs/actions/actions.scss"],names:[],mappings:"AAAA,4CACI,cAAA",sourceRoot:""}]),l.locals={menuItem:"-esm-laboratory__actions__menuItem___eDc9z"};const s=l},9896:(e,t,r)=>{r.d(t,{c:()=>s});var n=r(6004),a=r.n(n),o=r(1056),l=r.n(o)()(a());l.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-laboratory__result-form__container___cbQzv{margin:1rem}.-esm-laboratory__result-form__button___HUfpK{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-laboratory__result-form__button___HUfpK .cds--inline-loading{min-height:1rem !important}.-esm-laboratory__result-form__button___HUfpK .cds--inline-loading__text{font-size:unset !important}.-esm-laboratory__result-form__tablet____JXS_{padding:1.5rem 1rem;background-color:#fff;margin-top:auto}.-esm-laboratory__result-form__desktop___iBSNA{padding:0rem;margin-top:auto}.-esm-laboratory__result-form__form___LmFgx{display:flex;flex-direction:column;justify-content:space-between;height:calc(100vh - 6rem)}.omrs-breakpoint-lt-desktop .-esm-laboratory__result-form__form___LmFgx{background-color:#ededed}.omrs-breakpoint-gt-tablet .-esm-laboratory__result-form__form___LmFgx{background-color:#fff}","",{version:3,sources:["webpack://./node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/results/result-form.scss","webpack://./node_modules/@carbon/layout/scss/generated/_spacing.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCnDF,iDACE,WC0BW,CDvBb,8CACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAEA,mEACE,0BAAA,CAGF,yEACE,0BAAA,CAIJ,8CACE,mBAAA,CACA,qBDzBM,CC0BN,eAAA,CAGF,+CACE,YAAA,CACA,eAAA,CAGF,4CACE,YAAA,CACA,qBAAA,CACA,6BAAA,CACA,yBAAA,CAGF,wEACE,wBAAA,CAGF,uEACE,qBD9CM",sourceRoot:""}]),l.locals={container:"-esm-laboratory__result-form__container___cbQzv",button:"-esm-laboratory__result-form__button___HUfpK",tablet:"-esm-laboratory__result-form__tablet____JXS_",desktop:"-esm-laboratory__result-form__desktop___iBSNA",form:"-esm-laboratory__result-form__form___LmFgx"};const s=l},6076:(e,t,r)=>{r.d(t,{c:()=>f});var n=r(3604),a=r.n(n),o=r(7200),l=r.n(o),s=r(8272),i=r.n(s),u=r(712),c=r.n(u),d=r(6768),m=r.n(d),p=r(2116),A=r.n(p),_=r(355),b={};b.styleTagTransform=A(),b.setAttributes=c(),b.insert=i().bind(null,"head"),b.domAPI=l(),b.insertStyleElement=m(),a()(_.c,b);const f=_.c&&_.c.locals?_.c.locals:void 0},1276:(e,t,r)=>{r.r(t),r.d(t,{default:()=>L});var n=r(7244),a=r.n(n),o=r(4708),l=r(5824),s=r(3604),i=r.n(s),u=r(7200),c=r.n(u),d=r(8272),m=r.n(d),p=r(712),A=r.n(p),_=r(6768),b=r.n(_),f=r(2116),y=r.n(f),v=r(9896),C={};C.styleTagTransform=y(),C.setAttributes=A(),C.insert=m().bind(null,"head"),C.domAPI=c(),C.insertStyleElement=b(),i()(v.c,C);const g=v.c&&v.c.locals?v.c.locals:void 0;var h=r(4652),E=r(8704),w=r(4072);function k(e,t,r,n,a,o,l){try{var s=e[o](l),i=s.value}catch(e){return void r(e)}s.done?t(i):Promise.resolve(i).then(n,a)}function x(){return(e=function(e,t,r){var n;return function(e,t){var r,n,a,o,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,n=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!((a=(a=l.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){l=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){l.label=o[1];break}if(6===o[0]&&l.label<a[1]){l.label=a[1],a=o;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(o);break}a[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(e){o=[6,e],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}(this,(function(a){switch(a.label){case 0:return n=new AbortController,[4,(0,E.openmrsFetch)("".concat(E.restBaseUrl,"/order"),{method:"POST",headers:{"Content-Type":"application/json"},signal:n.signal,body:r})];case 1:return 201!==a.sent().status?[3,3]:[4,(0,E.openmrsFetch)("".concat(E.restBaseUrl,"/encounter/").concat(e),{method:"POST",headers:{"Content-Type":"application/json"},signal:n.signal,body:t})];case 2:return[2,a.sent()];case 3:return[2]}}))},x=function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function l(e){k(o,n,a,l,s,"next",e)}function s(e){k(o,n,a,l,s,"throw",e)}l(void 0)}))}).apply(this,arguments);var e}var N=r(4256);function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){O(e,t,r[t])}))}return e}function T(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const F=function(e){var t=e.concept,r=e.control,n=e.errors,l=(0,h.useTranslation)().t,s=function(e){var t,r;return"Text"===(null===(t=e.datatype)||void 0===t?void 0:t.display)||"Numeric"===(null===(r=e.datatype)||void 0===r?void 0:r.display)},i=function(e){var t;return"Coded"===(null===(t=e.datatype)||void 0===t?void 0:t.display)},u=function(e){var t;if("Numeric"===(null==e||null===(t=e.datatype)||void 0===t?void 0:t.display)){var r,n=Math.max(null==e?void 0:e.hiAbsolute,null==e?void 0:e.hiCritical,null==e?void 0:e.hiNormal),a=Math.min(null==e?void 0:e.lowAbsolute,null==e?void 0:e.lowCritical,null==e?void 0:e.lowNormal);return" (".concat(null!=a?a:0," - ").concat(n>0?n:"--"," ").concat(null!==(r=null==e?void 0:e.units)&&void 0!==r?r:"",")")}return""};return a().createElement(a().Fragment,null,Object.keys(n).length>0&&a().createElement("div",{className:g.errorDiv},l("allFieldsRequired","All fields are required")),s(t)&&a().createElement(N.Mc,{control:r,rules:{required:!0},name:t.uuid,render:function(e){var r,n=e.field;return a().createElement(o.gf6,T(B({key:t.uuid,className:g.textInput},n),{type:"Numeric"===t.datatype.display?"number":"text",labelText:(null==t?void 0:t.display)+("Numeric"===t.datatype.display&&null!==(r=u(t))&&void 0!==r?r:""),autoFocus:!0}))}}),i(t)&&a().createElement(N.Mc,{name:t.uuid,control:r,rules:{required:!0},render:function(e){var r,n=e.field;return a().createElement(o.M1e,T(B({key:t.uuid,className:g.textInput},n),{type:"text",labelText:null==t?void 0:t.display,rules:{required:!0}}),a().createElement(o.gV5,{text:l("chooseOption","Choose an Option"),value:""}),null==t||null===(r=t.answers)||void 0===r?void 0:r.map((function(e){return a().createElement(o.gV5,{key:e.uuid,text:e.display,value:e.uuid},e.display)})))}}),function(e){var t;return(null===(t=e.setMembers)||void 0===t?void 0:t.length)>0}(t)&&t.setMembers.map((function(e,t){return s(e)?a().createElement(N.Mc,{control:r,name:e.uuid,rules:{required:!0},render:function(r){var n,l=r.field;return a().createElement(o.gf6,T(B({key:e.uuid,className:g.textInput},l),{type:"Numeric"===e.datatype.display?"number":"text",labelText:(null==e?void 0:e.display)+("Numeric"===e.datatype.display&&null!==(n=u(e))&&void 0!==n?n:""),autoFocus:0===t}))}}):i(e)?a().createElement(N.Mc,{name:e.uuid,control:r,rules:{required:!0},render:function(r){var n,s=r.field;return a().createElement(o.M1e,T(B({key:e.uuid,className:g.textInput},s),{type:"text",labelText:null==e?void 0:e.display,autoFocus:0===t}),a().createElement(o.gV5,{text:l("option","Choose an Option"),value:""}),null==e||null===(n=e.answers)||void 0===n?void 0:n.map((function(e){return a().createElement(o.gV5,{key:e.uuid,text:e.display,value:e.uuid},e.display)})))}}):void 0})))};var S=r(1728),M={};M.styleTagTransform=y(),M.setAttributes=A(),M.insert=m().bind(null,"head"),M.domAPI=c(),M.insertStyleElement=b(),i()(S.c,M);const j=S.c&&S.c.locals?S.c.locals:void 0,P=function(){var e=(0,h.useTranslation)().t;return a().createElement(o.kp8,{className:j.loading,description:"".concat(e("loading","Loading")," ...")})},D=function(e){var t,r,s,i,u,c,d,m,p=e.order,A=e.patientUuid,_=(0,h.useTranslation)().t,b=(0,N.aS)({defaultValues:{}}),f=b.control,y=b.register,v=b.formState,C=v.isSubmitting,k=v.errors,O=b.getValues,B=b.handleSubmit,T="tablet"===(0,E.useLayoutType)(),S=(0,E.usePatient)(A),M=S.patient,j=S.isLoading,D=(t=p.concept.uuid,r="".concat(E.restBaseUrl,"/concept/").concat(t,"?v=custom:(uuid,display,name,datatype,set,answers,hiNormal,hiAbsolute,hiCritical,lowNormal,lowAbsolute,lowCritical,units,setMembers:(uuid,display,answers,datatype,hiNormal,hiAbsolute,hiCritical,lowNormal,lowAbsolute,lowCritical,units))"),i=(s=(0,w.cp)(r,E.openmrsFetch)).data,u=s.error,c=s.isLoading,d=s.isValidating,m=s.mutate,{concept:null==i?void 0:i.data,isLoading:c,isError:u,isValidating:d,mutate:m}),I=D.concept,L=D.isLoading,q=(0,n.useMemo)((function(){if(M)return{patient:M,patientUuid:A,hideActionsOverflow:!0}}),[M,A]);return j||L?a().createElement(P,null):a().createElement(o.QFz,{className:g.form},a().createElement(o.yex,null,a().createElement(E.ExtensionSlot,{name:"patient-header-slot",state:q})),a().createElement(o.yex,{className:g.container},a().createElement("section",null,I.setMembers.length>0&&a().createElement("div",null,I.display),I&&a().createElement(F,{register:y,concept:I,control:f,errors:k}))),a().createElement(o.cnc,{className:T?g.tablet:g.desktop},a().createElement(o.qaq,{className:g.button,disabled:C,onClick:function(){return(0,l.qe)()},kind:"secondary"},_("cancel","Cancel")),a().createElement(o.qaq,{className:g.button,onClick:B((function(e,t){t.preventDefault();var r=[];if(I.set&&I.setMembers.length>0){var n=[];I.setMembers.forEach((function(e){var t;"Numeric"===e.datatype.display||"Text"===e.datatype.display?t=O()["".concat(e.uuid)]:"Coded"===e.datatype.display&&(t={uuid:O()["".concat(e.uuid)]});var r={concept:{uuid:e.uuid},value:t,status:"FINAL",order:{uuid:p.uuid}};n.push(r)})),r.push({concept:{uuid:p.concept.uuid},status:"FINAL",order:{uuid:p.uuid},groupMembers:n})}else if(!I.set&&0===I.setMembers.length){var a;"Numeric"===I.datatype.display||"Text"===I.datatype.display?a=O()["".concat(I.uuid)]:"Coded"===I.datatype.display&&(a={uuid:O()["".concat(I.uuid)]}),r.push({concept:{uuid:p.concept.uuid},status:"FINAL",order:{uuid:p.uuid},value:a})}var o={obs:r},s={previousOrder:p.uuid,type:"testorder",action:"DISCONTINUE",careSetting:p.careSetting.uuid,encounter:p.encounter.uuid,patient:p.patient.uuid,concept:p.concept.uuid,orderer:p.orderer};(function(e,t,r){return x.apply(this,arguments)})(p.encounter.uuid,o,s).then((function(){(0,E.showSnackbar)({isLowContrast:!0,title:_("updateEncounter","Update lab results"),kind:"success",subtitle:_("generateSuccessfully","You have successfully updated test results")}),(0,l.qe)()}),(function(e){(0,E.showNotification)({title:_("errorUpdatingEncounter', 'Error occurred while updating test results"),kind:"error",critical:!0,description:null==e?void 0:e.message})}))}))},_("save","Save"))))};var I=r(6076);const L=function(e){var t=e.order,r=(0,h.useTranslation)().t;return a().createElement(o.YT$,{itemText:r("labResultsForm","Lab Results Form"),onClick:function(){(0,l.S6)(r("labResultsForm","Lab Results Form"),a().createElement(D,{patientUuid:t.patient.uuid,order:t}))},className:I.c.menuItem})}}}]);