"use strict";(globalThis.webpackChunk_openmrs_esm_patient_allergies_app=globalThis.webpackChunk_openmrs_esm_patient_allergies_app||[]).push([[489],{8137:(e,t,n)=>{n.d(t,{Z:()=>o});var r=n(272),a=n.n(r),l=n(2609),i=n.n(l)()(a());i.push([e.id,":root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}:root{--brand-01: #005d5d;--brand-02: #004144;--brand-03: #007d79}.-esm-patient-allergies__allergy-form__productiveHeading01___jVHlb{font-size:var(--cds-heading-compact-01-font-size, 0.875rem);font-weight:var(--cds-heading-compact-01-font-weight, 600);line-height:var(--cds-heading-compact-01-line-height, 1.28572);letter-spacing:var(--cds-heading-compact-01-letter-spacing, 0.16px)}.-esm-patient-allergies__allergy-form__productiveHeading02___AqkSP{font-size:var(--cds-heading-compact-02-font-size, 1rem);font-weight:var(--cds-heading-compact-02-font-weight, 600);line-height:var(--cds-heading-compact-02-line-height, 1.375);letter-spacing:var(--cds-heading-compact-02-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__productiveHeading03___Dz8TI{font-size:var(--cds-heading-03-font-size, 1.25rem);font-weight:var(--cds-heading-03-font-weight, 400);line-height:var(--cds-heading-03-line-height, 1.4);letter-spacing:var(--cds-heading-03-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__productiveHeading04___O3iLB{font-size:var(--cds-heading-04-font-size, 1.75rem);font-weight:var(--cds-heading-04-font-weight, 400);line-height:var(--cds-heading-04-line-height, 1.28572);letter-spacing:var(--cds-heading-04-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__productiveHeading05___HYHD4{font-size:var(--cds-heading-05-font-size, 2rem);font-weight:var(--cds-heading-05-font-weight, 400);line-height:var(--cds-heading-05-line-height, 1.25);letter-spacing:var(--cds-heading-05-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__productiveHeading06___EpNh_{font-size:var(--cds-heading-06-font-size, 2.625rem);font-weight:var(--cds-heading-06-font-weight, 300);line-height:var(--cds-heading-06-line-height, 1.199);letter-spacing:var(--cds-heading-06-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__bodyShort01___b4MZO{font-size:var(--cds-body-compact-01-font-size, 0.875rem);font-weight:var(--cds-body-compact-01-font-weight, 400);line-height:var(--cds-body-compact-01-line-height, 1.28572);letter-spacing:var(--cds-body-compact-01-letter-spacing, 0.16px)}.-esm-patient-allergies__allergy-form__bodyShort02___GvHHe{font-size:var(--cds-body-compact-02-font-size, 1rem);font-weight:var(--cds-body-compact-02-font-weight, 400);line-height:var(--cds-body-compact-02-line-height, 1.375);letter-spacing:var(--cds-body-compact-02-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__bodyLong01___g6fq0{font-size:var(--cds-body-01-font-size, 0.875rem);font-weight:var(--cds-body-01-font-weight, 400);line-height:var(--cds-body-01-line-height, 1.42857);letter-spacing:var(--cds-body-01-letter-spacing, 0.16px)}.-esm-patient-allergies__allergy-form__bodyLong02___Rzjzc{font-size:var(--cds-body-02-font-size, 1rem);font-weight:var(--cds-body-02-font-weight, 400);line-height:var(--cds-body-02-line-height, 1.5);letter-spacing:var(--cds-body-02-letter-spacing, 0)}.-esm-patient-allergies__allergy-form__label01___KyOYB{font-size:var(--cds-label-01-font-size, 0.75rem);font-weight:var(--cds-label-01-font-weight, 400);line-height:var(--cds-label-01-line-height, 1.33333);letter-spacing:var(--cds-label-01-letter-spacing, 0.32px)}.-esm-patient-allergies__allergy-form__header___QZLSQ{border-bottom:.0625rem solid #e0e0e0;margin:0}.-esm-patient-allergies__allergy-form__content___BiJ1K{display:grid;grid-template-columns:50% 10% 1fr;margin:.5rem 1rem}.-esm-patient-allergies__allergy-form__wrapperContainer___sEcVG fieldset{display:grid;grid-template-columns:1fr 1fr;width:100%}.-esm-patient-allergies__allergy-form__wrapperContainer___sEcVG .cds--radio-button__label{justify-content:flex-start}.-esm-patient-allergies__allergy-form__radio___cCJp1{margin:1rem 0rem}.-esm-patient-allergies__allergy-form__radio___cCJp1 label{justify-content:flex-start}.-esm-patient-allergies__allergy-form__checkbox___A9usx:not(:first-child){margin:.3rem 0rem}.-esm-patient-allergies__allergy-form__input___RQrII{margin:0rem 1rem 1rem}.-esm-patient-allergies__allergy-form__checkboxContainer___EHQjt{display:grid;grid-template-columns:1fr 1fr}.-esm-patient-allergies__allergy-form__button___WnjB1{height:4rem;display:flex;align-content:flex-start;align-items:baseline;min-width:50%}.-esm-patient-allergies__allergy-form__desktopButtons___Xmt1r{margin-top:2rem}.-esm-patient-allergies__allergy-form__tabletButtons___rIW7a{margin-top:2rem;padding:1.5rem 1rem;background-color:#fff}.-esm-patient-allergies__allergy-form__actionButtons___j4Ggm{position:sticky;bottom:0}.-esm-patient-allergies__allergy-form__formContent___Z4i9n{margin:1rem}.-esm-patient-allergies__allergy-form__form___ri4Rk{display:flex;flex-direction:column;justify-content:space-between}.omrs-breakpoint-gt-tablet .-esm-patient-allergies__allergy-form__form___ri4Rk{height:calc(100vh - 6rem)}.omrs-breakpoint-lt-desktop .-esm-patient-allergies__allergy-form__form___ri4Rk{height:calc(100vh - 9rem)}","",{version:3,sources:["webpack://./../../node_modules/@openmrs/esm-styleguide/src/_vars.scss","webpack://./src/root.scss","webpack://./../../node_modules/@carbon/type/scss/_styles.scss","webpack://./src/allergies/allergies-form/allergy-form.scss"],names:[],mappings:"AAoDA,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CAHF,MACE,mBAAA,CACA,mBAAA,CACA,mBAAA,CCnDF,mEC81BI,2DAAA,CAAA,0DAAA,CAAA,8DAAA,CAAA,mEAAA,CD11BJ,mEC01BI,uDAAA,CAAA,0DAAA,CAAA,4DAAA,CAAA,8DAAA,CDt1BJ,mECs1BI,kDAAA,CAAA,kDAAA,CAAA,kDAAA,CAAA,sDAAA,CDl1BJ,mECk1BI,kDAAA,CAAA,kDAAA,CAAA,sDAAA,CAAA,sDAAA,CD90BJ,mEC80BI,+CAAA,CAAA,kDAAA,CAAA,mDAAA,CAAA,sDAAA,CD10BJ,mEC00BI,mDAAA,CAAA,kDAAA,CAAA,oDAAA,CAAA,sDAAA,CDt0BJ,2DCs0BI,wDAAA,CAAA,uDAAA,CAAA,2DAAA,CAAA,gEAAA,CDl0BJ,2DCk0BI,oDAAA,CAAA,uDAAA,CAAA,yDAAA,CAAA,2DAAA,CD9zBJ,0DC8zBI,gDAAA,CAAA,+CAAA,CAAA,mDAAA,CAAA,wDAAA,CD1zBJ,0DC0zBI,4CAAA,CAAA,+CAAA,CAAA,+CAAA,CAAA,mDAAA,CDtzBJ,uDCszBI,gDAAA,CAAA,gDAAA,CAAA,oDAAA,CAAA,yDAAA,CC71BJ,sDACE,oCAAA,CACA,QAAA,CAGF,uDACE,YAAA,CACA,iCAAA,CACA,iBAAA,CAGF,yEACE,YAAA,CACA,6BAAA,CACA,UAAA,CAGF,0FACE,0BAAA,CAGF,qDACE,gBAAA,CAEA,2DACE,0BAAA,CAKF,0EACE,iBAAA,CAIJ,qDACE,qBAAA,CAGF,iEACE,YAAA,CACA,6BAAA,CAGF,sDACE,WAAA,CACA,YAAA,CACA,wBAAA,CACA,oBAAA,CACA,aAAA,CAGF,8DACE,eAAA,CAGF,6DACE,eAAA,CACA,mBAAA,CACA,qBH/DM,CGkER,6DACE,eAAA,CACA,QAAA,CAGF,2DACE,WAAA,CAGF,oDACE,YAAA,CACA,qBAAA,CACA,6BAAA,CAKA,+EACE,yBAAA,CAMF,gFACE,yBAAA",sourceRoot:""}]),i.locals={productiveHeading01:"-esm-patient-allergies__allergy-form__productiveHeading01___jVHlb",productiveHeading02:"-esm-patient-allergies__allergy-form__productiveHeading02___AqkSP",productiveHeading03:"-esm-patient-allergies__allergy-form__productiveHeading03___Dz8TI",productiveHeading04:"-esm-patient-allergies__allergy-form__productiveHeading04___O3iLB",productiveHeading05:"-esm-patient-allergies__allergy-form__productiveHeading05___HYHD4",productiveHeading06:"-esm-patient-allergies__allergy-form__productiveHeading06___EpNh_",bodyShort01:"-esm-patient-allergies__allergy-form__bodyShort01___b4MZO",bodyShort02:"-esm-patient-allergies__allergy-form__bodyShort02___GvHHe",bodyLong01:"-esm-patient-allergies__allergy-form__bodyLong01___g6fq0",bodyLong02:"-esm-patient-allergies__allergy-form__bodyLong02___Rzjzc",label01:"-esm-patient-allergies__allergy-form__label01___KyOYB",header:"-esm-patient-allergies__allergy-form__header___QZLSQ",content:"-esm-patient-allergies__allergy-form__content___BiJ1K",wrapperContainer:"-esm-patient-allergies__allergy-form__wrapperContainer___sEcVG",radio:"-esm-patient-allergies__allergy-form__radio___cCJp1",checkbox:"-esm-patient-allergies__allergy-form__checkbox___A9usx",input:"-esm-patient-allergies__allergy-form__input___RQrII",checkboxContainer:"-esm-patient-allergies__allergy-form__checkboxContainer___EHQjt",button:"-esm-patient-allergies__allergy-form__button___WnjB1",desktopButtons:"-esm-patient-allergies__allergy-form__desktopButtons___Xmt1r",tabletButtons:"-esm-patient-allergies__allergy-form__tabletButtons___rIW7a",actionButtons:"-esm-patient-allergies__allergy-form__actionButtons___j4Ggm",formContent:"-esm-patient-allergies__allergy-form__formContent___Z4i9n",form:"-esm-patient-allergies__allergy-form__form___ri4Rk"};const o=i},8238:(e,t,n)=>{n.r(t),n.d(t,{default:()=>N});var r=n(7900),a=n.n(r),l=n(2779),i=n.n(l),o=n(4924),s=n(4398),c=n(195),A=n(8883),d=n(3955),g=n(2870),_=n(9198),m=n.n(_),u=n(8697);n(3255);var p=n(6705),f=n(321),C=n.n(f),h=n(1195),y=n.n(h),v=n(3275),b=n.n(v),E=n(7162),B=n.n(E),D=n(2094),w=n.n(D),k=n(757),z=n.n(k),R=n(8137),S={};S.styleTagTransform=z(),S.setAttributes=B(),S.insert=b().bind(null,"head"),S.domAPI=y(),S.insertStyleElement=w(),C()(R.Z,S);const H=R.Z&&R.Z.locals?R.Z.locals:void 0;function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||T(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}var O=c.z.object({allergen:c.z.object({uuid:c.z.string(),display:c.z.string(),type:c.z.string()}).required(),nonCodedAllergen:c.z.string().optional(),allergicReactions:c.z.array(c.z.string().optional()),nonCodedAllergicReaction:c.z.string().optional(),severityOfWorstReaction:c.z.string(),comment:c.z.string().optional()});function F(e){var t=e.children;return e.isTablet?a().createElement(s.mh4,null,t," "):a().createElement(a().Fragment,null,t)}function j(e){var t=e.allergicReactions,n=e.methods,l=n.control,i=n.setValue,o=(0,r.useCallback)((function(e,t,n,r){e(n),i("allergicReactions.".concat(r),t?n:"",{shouldValidate:!0})}),[i]),c=t.map((function(e,t){return a().createElement(d.Qr,{key:e.uuid,name:"allergicReactions.".concat(t),control:l,defaultValue:"",render:function(n){var r=n.field,l=r.onBlur,i=r.onChange,c=r.value;return a().createElement(s.XZJ,{className:H.checkbox,labelText:e.display,id:e.uuid,onChange:function(e,n){var r=n.checked,a=n.id;o(i,r,a,t)},checked:Boolean(c),onBlur:l})}})}));return a().createElement(a().Fragment,null,c)}const N=function(e){var t,n,l,c,_,f=e.closeWorkspace,C=e.patientUuid,h=e.promptBeforeClosing,y=e.closeWorkspaceWithSavedChanges,v=(0,o.useTranslation)().t,b=(0,g.useConfig)().concepts,E="tablet"===(0,g.useLayoutType)(),B=[v("mild","Mild"),v("moderate","Moderate"),v("severe","Severe")],D=(0,r.useMemo)((function(){return{patientUuid:C}}),[C]),w=(0,r.useMemo)((function(){return b}),[b]),k=w.mildReactionUuid,z=w.severeReactionUuid,R=w.moderateReactionUuid,S=w.otherConceptUuid,x=(t=(0,g.useConfig)().concepts.allergyReactionUuid,l=(n=m()("/ws/rest/v1/concept/".concat(t,"?v=full"),g.openmrsFetch)).data,{isLoading:n.isLoading,allergicReactions:null==l?void 0:l.data.setMembers.map((function(e){return{uuid:e.uuid,display:e.display}}))}),N=x.allergicReactions,L=x.isLoading,W=function(){var e=(0,g.useConfig)().concepts,t=e.drugAllergenUuid,n=e.environmentalAllergenUuid,a=e.foodAllergenUuid,l=e.otherConceptUuid,i=m()("/ws/rest/v1/concept/".concat(t,"?v=full"),g.openmrsFetch).data,o=m()("/ws/rest/v1/concept/".concat(n,"?v=full"),g.openmrsFetch).data,s=m()("/ws/rest/v1/concept/".concat(a,"?v=full"),g.openmrsFetch).data;return(0,r.useMemo)((function(){var e=[],t=function(t,n){var r,a;null==t||null===(a=t.data)||void 0===a||null===(r=a.setMembers)||void 0===r||r.forEach((function(t){e.push({uuid:t.uuid,display:t.display,type:n})}))};return t(i,u.H.DRUG),t(o,u.H.ENVIRONMENT),t(s,u.H.FOOD),e.forEach((function(t,n){t.uuid===l&&e.splice(n,1)})),e.sort((function(e,t){return e.display.localeCompare(t.display)})),{allergens:e,isLoading:!i||!o||!s}}),[i,o,s])}().allergens,G=(c=(0,r.useState)(!0),_=2,function(e){if(Array.isArray(e))return e}(c)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,l=[],i=!0,o=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(l.push(r.value),!t||l.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(o)throw a}}return l}}(c,_)||T(c,_)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),J=G[0],Q=G[1],M=(0,p.PI)(C).mutate,U=(0,d.cI)({mode:"all",resolver:(0,A.F)(O),defaultValues:{allergen:null,nonCodedAllergen:"",allergicReactions:[],nonCodedAllergicReaction:"",severityOfWorstReaction:null,comment:""}}),V=U.control,Y=U.handleSubmit,Z=U.watch,q=(U.getValues,U.setValue),K=U.formState.isDirty;(0,r.useEffect)((function(){h((function(){return K}))}),[K]);var P=Z("allergen"),X=Z("allergicReactions"),$=Z("severityOfWorstReaction"),ee=Z("nonCodedAllergen"),te=Z("nonCodedAllergicReaction");(0,r.useEffect)((function(){var e=X.some((function(e){return""!==e}));Q(!(P&&e&&$))}),[X,Z,P,$,S,ee]);var ne=(0,r.useCallback)((function(e){var t=e.allergen,n=e.comment,r=e.nonCodedAllergen,a=e.nonCodedAllergicReaction,l=e.allergicReactions,i=e.severityOfWorstReaction,o=l.filter((function(e){return""!==e})),s={allergen:t.uuid==S?{allergenType:t.type,codedAllergen:{uuid:t.uuid},nonCodedAllergen:r}:{allergenType:t.type,codedAllergen:{uuid:t.uuid}},severity:{uuid:i},comment:n,reactions:null==o?void 0:o.map((function(e){return e===S?{reaction:{uuid:e},reactionNonCoded:a}:{reaction:{uuid:e}}}))},c=new AbortController;(function(e,t,n){return(0,g.openmrsFetch)("/ws/rest/v1/patient/".concat(t,"/allergy"),{headers:{"Content-Type":"application/json"},method:"POST",body:e,signal:n.signal})})(s,C,c).then((function(e){201===e.status&&(M(),y(),(0,g.showSnackbar)({isLowContrast:!0,kind:"success",title:v("allergySaved","Allergy saved"),subtitle:v("allergyNowVisible","It is now visible on the Allergies page")}))}),(function(e){(0,g.showSnackbar)({title:v("allergySaveError","Error saving allergy"),kind:"error",isLowContrast:!1,subtitle:null==e?void 0:e.message})})).finally((function(){return c.abort()}))}),[S,C,y,v,M]);return a().createElement(s.l09,{onSubmit:Y(ne)},E?a().createElement(s.X2j,{className:H.header},a().createElement(g.ExtensionSlot,{className:H.content,name:"patient-details-header-slot",state:D})):null,a().createElement("div",{className:H.form},a().createElement(s.Kqy,{gap:7,className:H.formContent},(null==P?void 0:P.uuid)===S&&a().createElement(s.K0D,{style:{minWidth:"100%"},kind:"warning",lowContrast:!0,hideCloseButton:!0,title:v("nonCodedAllergenWarningTitle","Warning: Custom Allergen Entry"),subtitle:v("nonCodedAllergenWarningDescription","Adding a custom allergen may impact system-wide allergy notifications. It's recommended to choose from the provided list for accurate alerts. Custom entries may not trigger notifications in all relevant contexts.")}),a().createElement(F,{isTablet:E},a().createElement(s.cwH,{legendText:v("allergen","Allergen"),"data-testid":"allergens-container"},a().createElement(d.Qr,{name:"allergen",control:V,render:function(e){var t=e.field,n=t.value,r=t.onChange;return a().createElement(s.CtY,{id:"allergen",items:I(W).concat([{uuid:S,display:v("other","Other"),type:u.H.OTHER}]),itemToString:function(e){return null==e?void 0:e.display},placeholder:v("selectAllergen","Select the allergen"),selectedItem:n,onChange:function(e){var t=e.selectedItem;return r(t)}})}}))),(null==P?void 0:P.uuid)===S&&a().createElement(F,{isTablet:E},a().createElement(d.Qr,{name:"nonCodedAllergen",control:V,render:function(e){var t=e.field,n=t.onBlur,r=t.onChange,l=t.value;return a().createElement(s.oil,{id:"nonCodedAllergen",labelText:v("otherNonCodedAllergen","Other non-coded allergen"),onChange:r,onBlur:n,value:l,placeholder:v("typeAllergenName","Please type in the name of the allergen")})}})),a().createElement("div",null,a().createElement("div",{className:E?H.checkboxContainer:void 0},L?a().createElement(s.lSo,{description:"".concat(v("loading","Loading")," ...")}):a().createElement(s.cwH,{legendText:v("selectReactions","Select the reactions"),"data-testid":"allergic-reactions-container"},a().createElement(j,{allergicReactions:N,methods:{setValue:q,control:V}}))),(null==X?void 0:X.includes(S))?a().createElement("div",{className:H.input},a().createElement(F,{isTablet:E},a().createElement(d.Qr,{name:"nonCodedAllergicReaction",control:V,render:function(e){var t=e.field,n=t.onBlur,r=t.onChange,l=t.value;return a().createElement(s.oil,{id:"nonCodedAllergicReaction",labelText:v("otherNonCodedAllergicReaction","Other non-coded allergic reaction"),onChange:r,onBlur:n,value:l,placeholder:v("typeAllergicReactionName","Please type in the name of the allergic reaction")})}}))):null),a().createElement("div",null,a().createElement(s.cwH,{legendText:v("severityOfWorstReaction","Severity of worst reaction")},a().createElement(d.Qr,{name:"severityOfWorstReaction",control:V,render:function(e){var t=e.field,n=t.onBlur,r=t.onChange,l=t.value;return a().createElement(s.SYO,{name:"severity-of-worst-reaction",onChange:function(e){return r(e.toString())},valueSelected:l,onBlur:n,labelText:v("severityOfWorstReaction","Severity of worst reaction")},B.map((function(e,t){return a().createElement(s.EUY,{id:e.toLowerCase()+"Severity",key:"severity-".concat(t),labelText:e,value:function(){switch(e.toLowerCase()){case"mild":return k;case"moderate":return R;case"severe":return z;default:return""}}()})})))}}))),a().createElement("div",null,a().createElement(F,{isTablet:E},a().createElement(d.Qr,{name:"comment",control:V,render:function(e){var t=e.field,n=t.onBlur,r=t.onChange,l=t.value;return a().createElement(s.Kx8,{id:"comments",invalidText:v("invalidComment","Invalid comment, try again"),labelText:v("dateOfOnsetAndComments","Date of onset and comments"),onChange:r,placeholder:v("typeAdditionalComments","Type any additional comments here"),onBlur:n,value:l,rows:4})}})))),a().createElement(s.uVA,{className:i()(E?H.tabletButtons:H.desktopButtons,H.actionButtons)},a().createElement(s.zxk,{className:H.button,onClick:f,kind:"secondary"},v("discard","Discard")),a().createElement(s.zxk,{className:H.button,disabled:J||(null==P?void 0:P.uuid)===S&&!ee||(null==X?void 0:X.includes(S))&&!te,type:"submit",kind:"primary"},v("saveAndClose","Save and close")))))}}}]);